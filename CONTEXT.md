# OpenClaw (formerly Moltbot) - Project Context

**Date:** 2026-01-30
**Goal:** Transform the Cloudflare Agents Starter Kit into "OpenClaw" - a fully autonomous, self-configuring, vision-enabled AI worker.

## üö© Project State

This project has been heavily modified from the default starter template to support **Autonomous Capabilities**. The core philosophy is that the agent should manage its own lifecycle, configuration, and tools.

## üèóÔ∏è Architectural Changes

### 1. Unified Tooling System (`worker/tools.ts`)
*   **Refactor**: Moved away from hardcoded `Env` types to a generic `MoltbotAgent` interface.
*   **Purpose**: Allows tools to be shared between the WebSocket Chat interface (`Chat` DO) and the MCP Server (`MoltbotMcp` DO).
*   **Key Tools Implemented**:
    *   `configure_moltbot`: Writes to `~/.openclaw/config.json5` and triggers process restart.
    *   `read_moltbot_config`: Reads current configuration.
    *   `browse_page`: Uses Puppeteer (@cloudflare/puppeteer) to read/screenshot websites.
    *   `manage_devices`: Listings and approving IoT devices via the gateway.

### 2. Model Context Protocol (MCP) Server (`worker/mcp.ts`)
*   **New Feature**: Implemented an MCP server at the `/mcp` endpoint.
*   **Technology**: Uses `@modelcontextprotocol/sdk`.
*   **Function**: Exposes OpenClaw's internal tools to external clients (Claude Desktop, Cursor, other LLMs).
*   **Integration**: Registered `configure_moltbot`, `read_moltbot_config`, `browse_page`, and `manage_devices` tools.

### 3. Docker Sandbox Environment
*   **Fixes**:
    *   Updated `wrangler.jsonc` to point to the correct `./Dockerfile`.
    *   Synced `Dockerfile` with `refrence-apps/moltworker` to include Node.js 22, `clawdbot` CLI, and necessary templates.
    *   Restored build assets: `start-moltbot.sh`, `moltbot.json.template`, `skills/` directory.
*   **Status**: `npm run dev` now successfully builds the custom container image.

## üõ†Ô∏è Key Files & Locations

*   **`worker/tools.ts`**: The "Brain". All capability definitions live here.
*   **`worker/mcp.ts`**: The "External Interface". logic for handling MCP requests.
*   **`worker/server.ts`**: The "Router". Handles incoming HTTP traffic and routes to appropriate DOs.
*   **`wrangler.jsonc`**: Infrastructure config. Defines `Browser`, `AI`, and `Sandbox` bindings.
*   **`Dockerfile`**: Defines the OpenClaw runtime environment (Node 22 + capabilities).

## üöÄ How to Run

1.  **Prerequisites**:
    *   Node.js v22.12+ (Required by Vite/Cloudflare).
    *   Docker Desktop (Must be running for the Sandbox build).

2.  **Commands**:
    *   `npm run dev`: Starts local dev server + builds Docker container.
    *   `npm run deploy`: Deploys to Cloudflare Workers.

## üìù Renaming & Branding

*   **Project Name**: OpenClaw.
*   **Internal Code**: Still uses `moltbot` / `configureMoltbot` to maintain stability and avoid breaking references.
*   **Documentation**: Verified `README.md` and `BLOG.md` reflect the "OpenClaw" branding.

## ‚ö†Ô∏è Known Gotchas for Future Devs

1.  **Docker Build Speed**: The initial `npm run dev` pulls the `cloudflare/sandbox` image which can take a few minutes.
2.  **Tool Context**: When adding new tools, ensure they use `getCurrentAgent<MoltbotAgent>()` instead of assuming a specific `this` context, so they work in both Chat and MCP modes.
3.  **Config Persistence**: Configuration written by `configure_moltbot` persists in the standard `~/.openclaw/config.json5` location within the sandbox.

---
*Generated by the implementation team to ensure continuity.*
